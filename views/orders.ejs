<% include layout/sidebar %>
<% include layout/header %>
<div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                      <div style="margin-bottom:10px; padding-left:85%;">
                        <a href="/new_order" class="btn btn-round btn-fill btn-info">Start New Order</a>
                      </div>
                        <div class="card">
                            <div class="header">
                                <h4 class="title">Orders</h4>
                                <p class="category"></p>
                            </div>
                            <div class="content table-responsive table-full-width">
                                <table class="table table-striped">
                                    <thead>
                                      <th>Order ID</th>
                                      <th>Order</th>
                                      <th>Restaurant</th>
                                      <th>Invited</th>
                                      <th>Joined</th>
                                      <th>Status</th>
                                      <th>Actions</th>
                                    </thead>
                                    <tbody>

                                        <% for(var i=0; i < orders.length; i++) { %>
                                          <tr>
                                            <td><%= orders[i].order_id %></td>
                                            <td><%= orders[i].meal_type %></td>
                                            <td><%= orders[i].resturant %></td>
                                            <td>10</td>
                                            <td>5</td>
                                            <td><%= orders[i].order_status %></td>
                                            <td>
                                              <a class="view">view</a>
                                              <a class="view" id="<%= orders[i].order_id%>" href="/order_details?order_id=<%=orders[i].order_id%>">view</a>
                                              <% if (orders[i].order_status == "waiting"){ %>
                                                <a class="finish" id="<%= orders[i].order_id%>">finish</a>
                                                <a class="cancel" id="<%= orders[i].order_id%>">cancel</a>
                                              <% } %>
                                          </td>
                                          </tr>
                                            <% } %>

                                        <tr>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                        </tr>
                                        <tr>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                        </tr>
                                        <tr>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                        </tr>
                                        <tr>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                          <td></td>
                                        </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <script>
          $(function(){
<<<<<<< HEAD
=======
            var longPolling=function(){
>>>>>>> 05ee7395535f435317358437fee46389b976535a
            $.ajax({
              url:"http://localhost:8090/orders",
              method:"GET",
              success:function(response) {
<<<<<<< HEAD
                console.log("Render");
              },
              error:function() {
                console.log(err);
              }
            });
            $(".view").click(function (event){
              console.log($(this).parent().first().text());
              $.ajax({
                  url:"http://localhost:8090/order_details",
                  method:"GET",
                  data:{order_id:order_id},
                  success:function(response){
                     console.log("LOL");
                  },
                  error:function(error){
                    console.log(error);
                  }
                });
});
          });
          // $(function(){
            // $.ajax({
            //   url:"http://localhost:8090/orders",
            //   method:"GET",
            //   success:function(response) {
            //     //console.log(response);
            //   },
            //   error:function() {
            //     //console.log(err);
            //   }
            // });
=======
                //console.log(response);
              },
              complete: function(){
                  longPolling()
              },
              timeout: 30000,
              error:function() {
                //console.log(err);
              }
            });
          }
>>>>>>> 05ee7395535f435317358437fee46389b976535a

            $(".finish").click(function(event){
              console.log("HEYYYYYY");
              order_id=$(this).attr('id');
              console.log(order_id);
              $.ajax({
                url:"http://localhost:8090/orders",
                method:"put",
                data:{order_id:parseInt(order_id)},
                success:function(response){
                  console.log("success");
                },
                error:function(error){
                  console.log(error);
                }
              });
            });

            $(".cancel").click(function(event){
              console.log("HEYYYYYY");
              order_id=$(this).attr('id');
              console.log(order_id);
              $.ajax({
                url:"http://localhost:8090/orders",
                method:"delete",
                data:{order_id:parseInt(order_id)},
                success:function(response){
                  $(this).remove();
                },
                error:function(error){
                  console.log(error);
                }
              });
            });
          });
        </script>
<%include layout/footer %>
